{% extends "admin/light_base.html" %}
{% load i18n admin_static %}



{% block main_content %}



    <h2 style="display: inline">查询统计</h2>
    <a style="margin-left: 20px" href="#" id="show_filter">查询选项</a>

<div id="filter" class="well" style="margin-top: 20px; display: none" >
    <form class="form-horizontal">

        {% for key in keys %}
            <input type="hidden" name="keys" value="{{ key }}">
        {% endfor %}
        {% for condition in conditions %}
            <input type="hidden" name="conditions" value="{{ condition }}">
        {% endfor %}
        {% for value in values %}
            <input type="hidden" name="values" value="{{ value }}">
        {% endfor %}

        <div class="control-group">
            <label class="control-label" style="width: 75px;text-align: left;">筛选条件:</label>
            <div class="controls" style="margin-left: 0px;">
                <select name="key" id="key">
                    <option value="anum">档案号</option>
                    <option value="rnum">检测报告编号</option>
                    <option value="rnum1">检测年份</option>
                    <option value="rnum2">地区类别</option>
                    <option value="rnum3">单位属性</option>
                    <option value="rnum4">报告编号</option>
                    <option value="name">单位名称</option>
                    <option value="address">单位地址</option>
                    <option value="project_name">项目名称</option>
                    <option value="project_address">项目地址</option>
                    <option value="gps">GPS定位信息</option>
                    <option value="time">检测时间</option>
                    <option value="contact_department">联系部门</option>
                    <option value="contact_person">联系人</option>
                    <option value="contact_phone">联系电话</option>
                    <option value="buildings">受检建（构）筑物名称及接地电阻</option>
                    <option value="category">防雷类别</option>
                    <option value="basis">检测依据</option>
                    <option value="weather">天气状况</option>
                    <option value="instrument_num">检测仪器及编号</option>
                    <option value="conclusion">检测结论</option>
                    <option value="validity">有效期</option>
                    <option value="write_person">编制员</option>
                    <option value="test_person">检测员</option>
                    <option value="check_person">审核员</option>
                    <option value="bill_person">计费员</option>
                    <option value="bill_check">计费复核</option>
                    <option value="amount">计费金额</option>
                    <option value="approve_person">批准人</option>
                    <option value="approve_time">批准日期</option>
                </select>
                <select name="condition" id="condition" style="width: 80px">
                    <option value="=">模糊</option>
                    <option value="==">精确</option>
                </select>
                <input type="text" name="value" id="value" placeholder="输入查询关键词">
            </div>
        </div>
        <div class="control-group">
            <label class="control-label" style="width: 75px;text-align: left;">起止时间:</label>
            <div class="controls" style="margin-left: 0px;">
                <select name="time1" style="width: 100px">
                    <option value="">不限</option>
                    <option value="2000" {% if time1 == '2000' %}selected{% endif %}>2000年</option>
                    <option value="2001" {% if time1 == '2001' %}selected{% endif %}>2001年</option>
                    <option value="2002" {% if time1 == '2002' %}selected{% endif %}>2002年</option>
                    <option value="2003" {% if time1 == '2003' %}selected{% endif %}>2003年</option>
                    <option value="2004" {% if time1 == '2004' %}selected{% endif %}>2004年</option>
                    <option value="2005" {% if time1 == '2005' %}selected{% endif %}>2005年</option>
                    <option value="2006" {% if time1 == '2006' %}selected{% endif %}>2006年</option>
                    <option value="2007" {% if time1 == '2007' %}selected{% endif %}>2007年</option>
                    <option value="2008" {% if time1 == '2008' %}selected{% endif %}>2008年</option>
                    <option value="2009" {% if time1 == '2009' %}selected{% endif %}>2009年</option>
                    <option value="2010" {% if time1 == '2010' %}selected{% endif %}>2010年</option>
                    <option value="2011" {% if time1 == '2011' %}selected{% endif %}>2011年</option>
                    <option value="2012" {% if time1 == '2012' %}selected{% endif %}>2012年</option>
                    <option value="2013" {% if time1 == '2013' %}selected{% endif %}>2013年</option>
                    <option value="2014" {% if time1 == '2014' %}selected{% endif %}>2014年</option>
                    <option value="2015" {% if time1 == '2015' %}selected{% endif %}>2015年</option>
                    <option value="2016" {% if time1 == '2016' %}selected{% endif %}>2016年</option>
                    <option value="2017" {% if time1 == '2017' %}selected{% endif %}>2017年</option>
                    <option value="2018" {% if time1 == '2018' %}selected{% endif %}>2018年</option>
                    <option value="2019" {% if time1 == '2019' %}selected{% endif %}>2019年</option>
                    <option value="2020" {% if time1 == '2020' %}selected{% endif %}>2020年</option>
                </select>
                -
                <select name="time2" style="width: 100px">
                    <option value="">不限</option>
                    <option value="2000" {% if time2 == '2000' %}selected{% endif %}>2000年</option>
                    <option value="2001" {% if time2 == '2001' %}selected{% endif %}>2001年</option>
                    <option value="2002" {% if time2 == '2002' %}selected{% endif %}>2002年</option>
                    <option value="2003" {% if time2 == '2003' %}selected{% endif %}>2003年</option>
                    <option value="2004" {% if time2 == '2004' %}selected{% endif %}>2004年</option>
                    <option value="2005" {% if time2 == '2005' %}selected{% endif %}>2005年</option>
                    <option value="2006" {% if time2 == '2006' %}selected{% endif %}>2006年</option>
                    <option value="2007" {% if time2 == '2007' %}selected{% endif %}>2007年</option>
                    <option value="2008" {% if time2 == '2008' %}selected{% endif %}>2008年</option>
                    <option value="2009" {% if time2 == '2009' %}selected{% endif %}>2009年</option>
                    <option value="2010" {% if time2 == '2010' %}selected{% endif %}>2010年</option>
                    <option value="2011" {% if time2 == '2011' %}selected{% endif %}>2011年</option>
                    <option value="2012" {% if time2 == '2012' %}selected{% endif %}>2012年</option>
                    <option value="2013" {% if time2 == '2013' %}selected{% endif %}>2013年</option>
                    <option value="2014" {% if time2 == '2014' %}selected{% endif %}>2014年</option>
                    <option value="2015" {% if time2 == '2015' %}selected{% endif %}>2015年</option>
                    <option value="2016" {% if time2 == '2016' %}selected{% endif %}>2016年</option>
                    <option value="2017" {% if time2 == '2017' %}selected{% endif %}>2017年</option>
                    <option value="2018" {% if time2 == '2018' %}selected{% endif %}>2018年</option>
                    <option value="2019" {% if time2 == '2019' %}selected{% endif %}>2019年</option>
                    <option value="2020" {% if time2 == '2020' %}selected{% endif %}>2020年</option>
                </select>
            </div>
        </div>
        <div class="control-group">
            <div class="controls" style="margin-left: 0px;">
                <label class="checkbox inline">
                    <input type="checkbox" name="checkall" {% if checkall %}checked{% endif %} onclick="$('input[type=checkbox]').prop('checked', $(this).prop('checked'))" >全部
                </label>
                <label class="checkbox inline">
                    <input type="checkbox" name="check_1" {% if check_1 %}checked{% endif %} >爆炸和火灾危险环境(新建)
                </label>
                <label class="checkbox inline">
                    <input type="checkbox" name="check_2" {% if check_2 %}checked{% endif %} >爆炸和火灾危险环境(年检)
                </label>
                <label class="checkbox inline">
                    <input type="checkbox" name="check_3" {% if check_3 %}checked{% endif %} >一般建筑场所(新建)
                </label>
                <label class="checkbox inline">
                    <input type="checkbox" name="check_4" {% if check_4 %}checked{% endif %} >一般建筑场所(年检)
                </label>
            </div>
        </div>
        <div class="control-group">
            <div class="controls" style="margin-left: 0px;">
                <button type="submit" class="btn btn-primary" name="submit" value="search">查询</button>
                <button type="submit" class="btn btn-warning" name="submit" value="filter">在结果中筛选</button>
                <button type="submit" class="btn" name="submit" value="output">导出结果</button>
            </div>
        </div>
    </form>

</div>

<div id="table" >
    <table class="tablesorter">
        <thead>
        <tr>
            <th >档案号</th>
            <th >检测报告编号</th>
            <th >单位名称</th>
            <th >单位地址</th>
            <th >项目名称</th>
            <th >项目地址</th>
            <th >GPS定位信息</th>
            <!-- <th >检测时间</th>
            <th >联系部门</th>
            <th >联系人</th>
            <th >联系电话</th>
            <th >受检建（构）筑物名称及接地电阻</th>
            <th >防雷类别</th>
            <th >检测依据</th>
            <th >天气状况</th>
            <th >检测仪器及编号</th>
            <th >检测结论</th>
            <th >有效期</th>
            <th >编制员</th>
            <th >检测员</th>
            <th >审核员</th>
            <th >计费员</th>
            <th >计费复核</th>
            <th >计费金额</th>
            <th >批准人</th>
            <th >批准日期</th> -->
            <th >操作</th>
        </tr>
        </thead>
        <tbody>
        {% for r in rs %}
            <tr>
                <td>{{ r.anum }}</td>
                <td>{{ r.rnum }}</td>
                <td>{{ r.name }}</td>
                <td>{{ r.address }}</td>
                <td>{{ r.project_name }}</td>
                <td>{{ r.project_address }}</td>
                <td><a href="/show_gps/?id={{ r.id }}" target="_blank" title="点击在地图上显示">{{ r.gps }}</a></td>
{#                <td>{{ r.time }}</td>#}
{#                <td>{{ r.contact_department }}</td>#}
{#                <td>{{ r.contact_person }}</td>#}
{#                <td>{{ r.contact_phone }}</td>#}
{#                <td>{{ r.buildings }}</td>#}
{#                <td>{{ r.category }}</td>#}
{#                <td>{{ r.basis }}</td>#}
{#                <td>{{ r.weather }}</td>#}
{#                <td>{{ r.instrument_num }}</td>#}
{#                <td>{{ r.conclusion }}</td>#}
{#                <td>{{ r.validity }}</td>#}
{#                <td>{{ r.write_person }}</td>#}
{#                <td>{{ r.test_person }}</td>#}
{#                <td>{{ r.check_person }}</td>#}
{#                <td>{{ r.bill_person }}</td>#}
{#                <td>{{ r.bill_check }}</td>#}
{#                <td>{{ r.amount }}</td>#}
{#                <td>{{ r.approve_person }}</td>#}
{#                <td>{{ r.approve_time }}</td>#}
                <td>
                    <a class="btn btn-mini" href="/unit_detail?id={{ r.id }}" >查看</a>
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
</div>



{% endblock %}


{% block js_footer %}

    <link href="/static/css/tablesorter/blue/style.css" rel="stylesheet"/>
    <script src="/static/js/jquery-1.10.2.js"></script>
    <script src="/static/js/jquery.cookie.js"></script>
    <script src="/static/js/jquery.tablesorter.js"></script>
    <script>

        $(".tablesorter").tablesorter({
            widgets: ['zebra']
        });

        if($.cookie("show_filter") == "true"){
            $("#filter").show()
        }

        $("#show_filter").click(function(){
            $("#filter").toggle()
            var show_filter = $("#filter").is(":visible")
            $.cookie("show_filter", show_filter)
        });

        $(function(){

            {% if value %}
                $("#key").val("{{ key }}")
                $("#condition").val("{{ condition }}")
                $("#value").val("{{ value }}")
            {% endif %}

            $("[name^='check_']").click(function(){
                $("[name='checkall']").prop("checked", false)
            })

        })
    </script>

{% endblock js_footer %}